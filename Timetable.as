package {		import flash.display.*;	import flash.events.*;	import flash.utils.Timer;	import flash.text.*;			public class Timetable extends Sprite		{			//Creating the textfield object 						//Text styling			public var timetableTextField:TextField;			public var timetableFormat:TextFormat;									private var time = new Date();			private var timechecktimer:Timer = new Timer(Config.getInstance().timetableRefresh);						private var sc:dots = new dots();			private var h1:dotnumbers = new dotnumbers();			private var h2:dotnumbers = new dotnumbers();			private var m1:dotnumbers = new dotnumbers();			private var m2:dotnumbers = new dotnumbers();						private var timetable:Array = new Array();			private var routes:Array = new Array();						public function Timetable() {				timetableTextField = Config.getInstance().timetableTextField;				timetableFormat =  Config.getInstance().timetableFormat;				setupTimetable();				timechecktimer.addEventListener(TimerEvent.TIMER,updateTime);				timechecktimer.start();				setupClock();			}						private function setupClock() {								Config.getInstance().theClock.addChild(h1);				Config.getInstance().theClock.addChild(h2);				Config.getInstance().theClock.addChild(m1);				Config.getInstance().theClock.addChild(m2);				Config.getInstance().theClock.addChild(sc);								sc.x = 840;				sc.y = 7;								h1.x = 735;				h1.y = 20;								h2.x = 790;				h2.y = 20;								m1.x = 870;				m1.y = 20;								m2.x = 925;				m2.y = 20;								h1.stop();				h2.stop();				m1.stop();				m2.stop();			}						public function updateTime(event){				time = new Date();				var themins =time.getMinutes();				var thehrs = time.getHours();				var currenttotaltime = int(themins) + int(thehrs)*60;				var strthemins = themins;				if(themins < 10) {					strthemins = "0"+themins;				}				var strthehrs = thehrs;				if(thehrs < 10) {					strthehrs = "0"+thehrs;				}				var thetime = thehrs+":"+strthemins;				var nextbustime:Number = 999999999;				var nextbusindex:Number = -1;				for(var i=0; i<timetable.length; i++) {					if(thetime == timetable[i]) {						//trace("A BUS");					} else {						var timetotest:Array = (timetable[i] as String).split(":");						var totaltime:Number = int(timetotest[1].substr(0,timetotest[1].length-1)) + int(timetotest[0]*60);						//trace(timetable[i],totaltime);						//trace(currenttotaltime);						if(totaltime > currenttotaltime) {							var thedifferenceintime = totaltime-currenttotaltime;							if(nextbustime > thedifferenceintime) {								nextbustime = thedifferenceintime;								nextbusindex = i;							}						}					}				}				if(nextbusindex > -1) {					//var str = thetime+" Next bus is at "+timetable[nextbusindex]+", (in "+nextbustime+" minutes)";										//var str = drawRouteLine(timetable[nextbusindex]);					//str += drawRouteLine(timetable[nextbusindex+1]);					//str += drawRouteLine(timetable[nextbusindex+2]);					var routeStrings = new Array();					for(var j=0; j<Config.getInstance().numberOfBuses; j++) {						routeStrings.push(drawRouteLine(timetable[nextbusindex+j]));					}										//var routeStrings = new Array(drawRouteLine(timetable[nextbusindex]),drawRouteLine(timetable[nextbusindex+1]),drawRouteLine(timetable[nextbusindex+2]));										Config.getInstance().setTimetableText(routeStrings);										//Config.getInstance().timetableTextField.text = str;					//Config.getInstance().setTextFrmt(timetableTextField, timetableFormat);					//trace(str);				}				drawclock();			}						public function drawRouteLine(thetime:String):String {				var timetogobold = Config.getInstance().highlightbustime;				var theroute = thetime.substr(thetime.length-1,1);				var prep = "";				var currenttotaltime = Number(time.getMinutes()) + 60*Number(time.getHours());				var timetabletime = thetime.split(":");				var thistime = Number(timetabletime[1].substr(0,timetabletime[1].length-1)) + 60*Number(timetabletime[0]);				if(currenttotaltime+timetogobold > thistime) {					prep = "*";				}				return prep+routes[theroute]+" "+thetime.substr(0,thetime.length-1)+"\n";			}						public function drawclock():void {				var hrs = time.getHours();				var mins = time.getMinutes();				if(mins < 10) {					mins = "0"+mins;				}				if(hrs < 10) {					hrs = "0"+hrs;				}				var timestring:String = hrs+""+mins;				h1.gotoAndStop(Number(timestring.substr(0,1))+1); //h1				h2.gotoAndStop(Number(timestring.substr(1,1))+1); //h2				m1.gotoAndStop(Number(timestring.substr(2,1))+1); //m1				m2.gotoAndStop(Number(timestring.substr(3,1))+1); //m2			}						public function addText(child:Object):void{								try{					this.addChild(child as DisplayObject);				}catch(e:Error){					trace(e);				}			}						public function setupTimetable() {								var forestpark = new Array(					"6:32","6:47","7:02","7:17","7:32","7:47","8:02","8:17","8:32","8:47","9:02","9:17","9:32","9:47","10:02","10:17","10:32","10:47","11:02","11:17","11:32","11:47","12:02","12:17","12:32","12:47","13:02","13:17","13:32","13:47","14:02","14:17","14:32","14:47","15:02","15:18","15:32","15:47","15:57","16:07","16:17","16:27","16:47","16:57","17:07","17:17","17:27","17:37","17:47","17:57","18:07","18:17","18:27","18:37","18:47","18:57","19:12","19:27","19:42","19:57","20:12","20:27","20:42","20:57","21:12","21:27","21:42","21:57","22:12","22:27","22:42","22:57","23:12","23:27","23:42","00:42"				);				setupRoute(forestpark,"a","385		Brisbane Forest Park		");								var aspley = new Array(					"6:37","6:52","7:07","7:22","7:37","7:52","8:07","8:22","8:37","8:52","9:07","9:22","9:37","9:52","10:07","10:22","10:37","10:52","11:07","11:22","11:37","11:52","12:07","12:22","12:37","12:52","13:07","13:22","13:37","13:52","14:07","14:22","14:37","14:52","15:07","15:20","15:30","15:40","15:50","16:00","16:10","16:20","16:30","16:40","16:50","17:00","17:10","19:20","19:37","19:52","20:07","20:22","20:37","20:52","21:07","21:22","21:37","21:52","22:07","22:22","22:37","22:52","23:07","23:22","23:37","00:07"				);				setupRoute(aspley,"b","345		Aspley					");								var carindale = new Array(					"6:46","7:01","7:16","7:31","7:46","8:01","8:16","8:31","8:46","9:01","9:16","9:31","9:46","10:01","10:16","10:31","10:46","11:01","11:16","11:31","11:46","12:01","12:16","12:31","12:46","13:01","13:16","13:31","13:46","14:01","14:11","14:21","14:31","14:41","14:51","15:01","15:09","15:16","15:24","15:31","15:39","15:46","15:54","16:02","16:10","16:17","16:25","16:32","16:40","16:47","16:50","16:55","17:00","17:02","17:10","17:10","17:17","17:20","17:25","17:30","17:32","17:40","17:40","17:40","17:47","17:50","17:55","18:00","18:01","18:10","18:10","18:11","18:20","18:21","18:30","18:30","18:31","18:46","19:01","19:16","19:31","19:46","20:01","20:16","20:31","20:46","21:01","21:16","21:31","21:46","22:01","22:16","22:31","22:46","23:01","23:16","23:31","24:16"				);				setupRoute(carindale,"c","200		Brisbane Carindale		");												timetable = timetable.sort();			}						public function setupRoute(routetimes:Array,id:String,routename:String) {				for(var i=0; i<routetimes.length; i++) {					routetimes[i] = routetimes[i]+id;				}				routes[id] = routename;				timetable = timetable.concat(routetimes);			}					}		}